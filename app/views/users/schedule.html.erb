<% responses = Array.new(@current_courses.length) %>
<% days = Array.new(@current_courses.length) %>
<% s_times = Array.new(@current_courses.length) %>
<% e_times = Array.new(@current_courses.length) %>
<% events = Array.new(5) %>

<% @current_courses.each_with_index do |curr, i| %>
	<% for j in 0..10 %> 
		<% responses[i] = HTTParty.get("http://www.sfu.ca/bin/wcm/course-outlines?#{curr.split(" ")[0]}/#{curr.split(" ")[1]}/#{curr.split(" ")[2..3].join("/")}/#{curr.split(" ")[4]}") %>
		<% if responses[i].count != 1 %> <!-- Won't have error message -->
			<% break %>
		<% elsif responses[i].count == 1 && !responses[i].has_key?('errorMessage') %> <!-- Just one result, but not an error -->
			<% break %>
		<% end %>
	<% end %>
	<% days[i] = Array.new(responses[i]["courseSchedule"].length) %>
	<% s_times[i] = Array.new(responses[i]["courseSchedule"].length) %>
	<% e_times[i] = Array.new(responses[i]["courseSchedule"].length) %>
	<% days[i].each_with_index do |day, j| %>
		<% day = responses[i]["courseSchedule"][j]["days"].split(", ") %>
		<% day.each_with_index do |w_day, k| %>
			<% w_set = case w_day %>
			<% when "Mo" %> 
				<% 1 %>
			<% when "Tu" %>
				<% 2 %>
			<% when "We" %>
				<% 3 %>
			<% when "Th" %>
				<% 4 %>
			<% when "Fr" %>
				<% 5 %>
			<% end %>
			<% day[k] = w_set %>
		<% end %>
		<%= days[i][j] = day %>
		<% s_times[i][j]= responses[i]["courseSchedule"][j]["startTime"] %>
		<% e_times[i][j]= responses[i]["courseSchedule"][j]["endTime"] %>
	<% end %>

<% end %>

<% if !days[0].blank? %>
	<table>
		<tr>
			<th>Time</th>
			<th>Monday</th>
			<th>Tuesday</th>
			<th>Wednesday</th>
			<th>Thursday</th>
			<th>Friday</th>
		</tr>
		<% for i in 16..48 %>
		<tr>
			<td>
				<% if i%2 == 0 %>
				  <% if i >= 26 %>
						<%= ((i/2)-12).to_s + ":00" %>
					<% else %>
						<%= (i/2).to_s + ":00" %>
					<% end %>
				<% else %>
					<% if i >= 26 %> 
						<%= ((i/2)-12).to_s + ":30" %>
					<% else %>
						<%= (i/2).to_s + ":30" %>
					<% end %>	
				<% end %>
			</td>
			<% @current_courses.each_with_index do |curr, j| %>
				<% for k in 1..5 %>
					<% days[j].each_with_index do |day,l| %>
						
						<% day.each do |wday,m| %>
							<% same_day = false %>
							<% if wday == k %>
								<% same_day = true %>
							<% elsif m==day.count-1 %>
								<td></td>
								<% break %>
							<% end %>
							<% if same_day %>
								<% if (i/2) == s_times[j][l].to_i %>
										<td>Hello</td>
								<% end %>
							<% end %>
			
						<% end %>
					<% end %>
				<% end %>
			<% end %>
		</tr>
		<% end %>
	</table>
<% end %>